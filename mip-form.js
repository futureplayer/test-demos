(window.MIP=window.MIP||[]).push({name:"mip-form",func:function(){define("mip-form/mip-form",["require","zepto","customElement","util","viewer"],function(e){function t(e){if(e.querySelector('input[type="password"],input[type="file"]'))return console.error("禁止使用password与file输入框"),!1;else return!0}function i(){var e=this.element,t=a(e),i=e.getAttribute("url"),n=e.getAttribute("method"),o=e.getAttribute("target"),p=document.createElement("form");p.action=i,p.method=n?n:"GET",p.target=o?o:"_blank",e.appendChild(p),s.dom.insert(p,e.children),t.find("form").on("submit",function(t){t.preventDefault(),r.call(e)}),e.addEventListener("keydown",function(e){if(13===e.keyCode)e.preventDefault(),r.call(this)},!1)}function n(e,t){return"must"===e?!(""===t):d[e.toUpperCase()].test(t)}function r(){var e=this,t=!1,i=a(e).find("input, textarea, select"),r="get"===e.getAttribute("method"),o=e.getAttribute("url"),p=o.match("http://"),u="";if(i.map(function(i,r){var o,p=r.getAttribute("validatetype"),l=r.getAttribute("validatetarget"),f=r.getAttribute("validatereg"),d=r.value;if("submit"!==r.type){if("checkbox"===r.type||"radio"===r.type)d=r.checked?r.value:"";if(u+="&"+r.name+"="+d,p){if(f)o=""===d?!1:new RegExp(f).test(d);else o=n(p,d);s.css(a(e).find('div[target="'+l+'"]'),{display:!o?"block":"none"}),t=!o?!0:t}}}),!t)if(window.parent!==window&&p&&r){var l="";if(o.match("\\?"))l=o+u;else u=u.substring(1),l=o+"?"+u;var f={event:"mibm-jumplink",data:{url:l}};window.parent.postMessage(f,"*")}else e.getElementsByTagName("form")[0].submit()}function o(){var e=document.querySelectorAll("input");Array.prototype.forEach.call(e,function(e,t){e.addEventListener("focus",function(){p("focus")},!1),e.addEventListener("blur",function(){p("blur")},!1)})}function p(e){if(f)l.sendMessage("input-"+e,{})}var a=e("zepto"),u=e("customElement").create(),s=e("util"),l=e("viewer"),f=l.isIframed,d={EMAIL:/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,PHONE:/^(13[0-9]|14[5|7]|15[0|1|2|3|4|5|6|7|8|9]|17[0|1|2|3|4|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\d{8}$/,IDCAR:/^\d{15}|\d{18}$/};return u.prototype.build=function(){function e(e){e.stopPropagation(),e.preventDefault();var t=e.target.getAttribute("name"),i=f.parentNode.querySelector('input[name="'+t+'"]');i.focus(),i.value="",s.css(f,{display:"none"})}var n=this.element,r=n.hasAttribute("clear");if(this.cross=null,t(n))i.call(this);if(r){var p=["text","input","datetime","email","number","search","tel","url"],a="";for(var u in p)a+=",input[type="+p[u]+"]";a=a.slice(1);var l=n.querySelectorAll(a);if(!l.length)return;var f=document.createElement("div");f.id="mip-form-cross",this.cross=f;for(var d=0;d<l.length;d++){var m=l[d].offsetHeight;l[d].addEventListener("focus",function(){var e=this;if(f.setAttribute("name",e.getAttribute("name")),s.css(f,{top:e.offsetTop+(m-16)/2-8+"px",left:e.offsetWidth-32+"px"}),e.parentNode.appendChild(f),""!==e.value)s.css(f,{display:"block"});else s.css(f,{display:"none"}),e.oninput=function(){if(!(s&&s.platform&&s.platform.isAndroid()&&"search"===e.type))s.css(f,{display:""!==e.value?"block":"none"})}},!1),l[d].addEventListener("blur",function(){s.css(f,{display:"none"})},!1)}f.addEventListener("touchstart",e,!1),f.addEventListener("mousedown",e,!1),f.addEventListener("click",e,!1)}o()},u}),define("mip-form",["mip-form/mip-form"],function(e){return e}),function(){function e(e,t){e.registerMipElement("mip-form",t,"mip-form{position:relative}mip-form #mip-form-cross{position:absolute;display:block;padding:6px;width:20px;height:20px;right:0;background:url(//m.baidu.com/static/search/clear.png) no-repeat center;z-index:100;background-size:100% 100%;background-origin:content-box;-webkit-tap-highlight-color:rgba(0,0,0,0.4);tap-highlight-color:rgba(0,0,0,0.4)}mip-form input,mip-form textarea,mip-form select{border:1px solid #f1f1f1;padding:6px;display:block;box-sizing:border-box;-webkit-box-sizing:border-box;resize:none;font-size:16px}mip-form input[type='text'],mip-form input[type='input'],mip-form input[type='datetime'],mip-form input[type='email'],mip-form input[type='number'],mip-form input[type='tel'],mip-form input[type='url']{padding-right:30px}mip-form input[type='radio']{display:inline}mip-form label{display:block}mip-form div{display:none;color:#ec1f5c;font-size:12px;text-align:left;padding:0 10% 0 3%}mip-form input[type='submit']{border:1px solid #f1f1f1;border-radius:5px;color:#333;background-color:#d8d7d7}")}if(window.MIP)require(["mip-form"],function(t){e(window.MIP,t)});else require(["mip","mip-form"],e)}()}});
